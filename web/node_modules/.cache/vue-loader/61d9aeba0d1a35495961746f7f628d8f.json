{"remainingRequest":"D:\\DTC PROJECT\\booking\\web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\DTC PROJECT\\booking\\web\\src\\views\\book_room.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\DTC PROJECT\\booking\\web\\src\\views\\book_room.vue","mtime":1578885705474},{"path":"D:\\DTC PROJECT\\booking\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DTC PROJECT\\booking\\web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DTC PROJECT\\booking\\web\\node_modules\\@vue\\cli-plugin-babel\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\DTC PROJECT\\booking\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\DTC PROJECT\\booking\\web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Datepicker from \"vuejs-datepicker\";\r\nimport service from \"@/service/service\";\r\n// import ViewData from './view/ViewData.vue';\r\nimport moment from \"moment\";\r\n// import firebase from 'firebase/app'ว\r\n// import * as firebase from 'firebase/app';\r\nimport flatPickr from \"vue-flatpickr-component\";\r\nimport \"flatpickr/dist/flatpickr.css\";\r\nimport { async } from \"q\";\r\n// import '@firebase/messaging';\r\nexport default {\r\n  components: {\r\n    Datepicker,\r\n    flatPickr\r\n  },\r\n  data() {\r\n    return {\r\n      submitted: false,\r\n      renderComponent: true,\r\n      editObj: {},\r\n      booking: false,\r\n      detail: \"\",\r\n      buildings: [],\r\n      important: \"\",\r\n      remark: \"\",\r\n      tel: \"\",\r\n      member: \"\",\r\n      searched: false,\r\n      rooms: [],\r\n      materials: [],\r\n      booking_data: {},\r\n      material: {},\r\n      material_lists: [],\r\n      configdateTimePicker: {\r\n        enableTime: false,\r\n        enableSeconds: false,\r\n        noCalendar: false\r\n      },\r\n      configTime: {\r\n        enableTime: true,\r\n        enableSeconds: true,\r\n        noCalendar: true\r\n      },\r\n      room_lists: [],\r\n      important_lists: [\"normal\", \"important\"]\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    body() {\r\n      return {\r\n        room_id: this.editObj.room_id,\r\n        start_date: this.editObj.date + \" \" + this.editObj.start_time,\r\n        end_date: this.editObj.date + \" \" + this.editObj.end_time,\r\n        building_id: this.editObj.building_id\r\n      };\r\n    }\r\n  },\r\n  async created() {\r\n    this.material = { material_id: \"\", material_number: \"\" };\r\n    this.initVal();\r\n\r\n    try {\r\n      var result = await service.postData(\"material/get\", {});\r\n\r\n      this.materials = result.data;\r\n\r\n      result = await service.postData(\"building/getBuilding\", {});\r\n      this.buildings = result.data;\r\n    } catch (e) {\r\n      this.$swal(this.$t(\"error\"), e.message, \"error\");\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    checkNumber(e) {\r\n      var checkNumber = window.checkNumber(e);\r\n      if (!checkNumber) {\r\n        e.preventDefault();\r\n      }\r\n    },\r\n    async initVal() {\r\n      this.editObj = {\r\n        building_id: \"\",\r\n        room_id: \"\",\r\n        date: moment().format(\"YYYY-MM-DD\"),\r\n        start_time: moment().format(\"HH:mm:ss\"),\r\n        end_time: \"17:30:00\"\r\n      };\r\n      this.booking = false;\r\n      this.detail = \"\";\r\n      this.buildings = [];\r\n      this.important = \"\";\r\n      this.remark = \"\";\r\n      this.tel = \"\";\r\n      this.member = \"\";\r\n    },\r\n    search() {\r\n      this.searched = true;\r\n      console.log(\"searching\");\r\n\r\n      if (!moment(this.body.start_date).isBefore(moment(this.body.end_date))) {\r\n        this.$swal(this.$t(\"start_date_canot_more_than_end_date\"), \"\", \"error\");\r\n      } else {\r\n        this.$vs.loading({\r\n          background: this.backgroundLoading,\r\n          color: this.colorLoading,\r\n          container: \"#button-with-loading\",\r\n          scale: 0.45\r\n        });\r\n        service.postData(\"get_room_with_status\", this.body).then(\r\n          result => {\r\n            this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\");\r\n            this.room_lists = result.data;\r\n          },\r\n          err => {\r\n            this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\");\r\n          }\r\n        );\r\n      }\r\n    },\r\n    add() {\r\n      this.material_lists.push({ material_id: \"\", material_number: \"\" });\r\n    },\r\n    book(item) {\r\n      this.booking = true;\r\n      var { username, first_name, last_name, email } = service.getUser().user;\r\n      this.booking_data = {\r\n        room_id: item.room_id,\r\n        start_date: this.body.start_date,\r\n        end_date: this.body.end_date,\r\n        username: username,\r\n        first_name: first_name,\r\n        last_name: last_name,\r\n        room_name: item.room_name,\r\n        email: email\r\n      };\r\n    },\r\n    checkMaterial() {\r\n      var x = this.material_lists.filter(item => {\r\n        return item.material_id == \"\" || item.material_number == \"\";\r\n      });\r\n      console.log(x);\r\n      return x.length == 0;\r\n    },\r\n    save() {\r\n      this.submitted = true;\r\n      var result = [];\r\n\r\n      if (\r\n        this.detail != \"\" &&\r\n        this.important != \"\" &&\r\n        this.member != \"\" &&\r\n        this.remark != \"\" &&\r\n        this.tel != \"\" &&\r\n        this.checkMaterial()\r\n      ) {\r\n        var materials = this.material_lists.map(item => item);\r\n        materials\r\n          .filter(item => item.material_number != \"\")\r\n          .reduce(function(res, value) {\r\n            if (!res[value.material_id]) {\r\n              res[value.material_id] = {\r\n                Id: value.material_id,\r\n                material_number: 0\r\n              };\r\n              result.push(res[value.material_id]);\r\n            }\r\n            res[value.material_id].material_number =\r\n              parseInt(res[value.material_id].material_number) +\r\n              parseInt(value.material_number);\r\n            return res;\r\n          }, {});\r\n        var material_lists = result.filter(item => item.material_number > 0);\r\n        this.$swal({\r\n          title: this.$t(\"booking_room_title\"),\r\n          type: \"warning\",\r\n          showCancelButton: true,\r\n          confirmButtonColor: \"#3085d6\",\r\n          cancelButtonColor: \"#d33\",\r\n          cancelButtonText: this.$t(\"cancel\"),\r\n          confirmButtonText: this.$t(\"book\"),\r\n          showLoaderOnConfirm: true,\r\n          preConfirm: () => {\r\n            var { username, room_id, start_date, end_date } = this.booking_data;\r\n            return service\r\n              .postData(\"/booking_room\", {\r\n                booking_description: this.detail,\r\n                username,\r\n                room_id,\r\n                start_date,\r\n                end_date,\r\n                material_lists,\r\n                important: this.important,\r\n                member: this.member,\r\n                remark: this.remark,\r\n                tel: this.tel\r\n              })\r\n              .then(result => {\r\n                return result;\r\n              });\r\n          }\r\n        }).then(result => {\r\n          if (result.value) {\r\n            if (result.value.code) {\r\n              this.$swal(this.$t(\"success_title\"), \"\", \"success\").then(\r\n                result => {\r\n                  this.booking = false;\r\n                  service.postData(\"get_room_with_status\", this.body).then(\r\n                    result => {\r\n                      // this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\")\r\n                      this.room_lists = result.data;\r\n                      this.material_lists = [];\r\n                      this.detail = \"\";\r\n                      this.important = \"\";\r\n                      this.submitted = false;\r\n                      this.initVal();\r\n                    },\r\n                    err => {\r\n                      // this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\")\r\n                    }\r\n                  );\r\n                }\r\n              );\r\n            } else {\r\n              this.$swal(this.$t(\"error\"), result.value.message, \"error\");\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    async \"editObj.building_id\"(val) {\r\n      this.editObj.room_id = \"\";\r\n      var result = await service.postData(\"getRoomByBuilding\", {\r\n        building_id: this.editObj.building_id\r\n      });\r\n      this.rooms = result.data;\r\n    }\r\n  }\r\n};\r\n",{"version":3,"sources":["book_room.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"book_room.vue","sourceRoot":"src/views","sourcesContent":["<template >\r\n  <div class=\"vx-col w-full mb-base\" v-if=\"renderComponent\">\r\n    <div class=\"w-full\" v-if=\"!booking\">\r\n      <vx-card>\r\n        <h6>{{$t(\"search_free_room\")}}</h6>\r\n        <div class=\"vx-row\">\r\n          <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-6\">\r\n            <label>{{$t(\"Building\")}}</label>\r\n            <vs-select class=\"w-full\" v-model=\"editObj.building_id\">\r\n              <vs-select-item value :text=\"$t('all')\" />\r\n              <vs-select-item\r\n                :key=\"index\"\r\n                :value=\"item.building_id\"\r\n                :text=\"$t(item.building_name)\"\r\n                v-for=\"(item,index) in buildings\"\r\n              />\r\n            </vs-select>\r\n          </div>\r\n          <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-6\">\r\n            <label>{{$t(\"room\")}}</label>\r\n            <vs-select class=\"w-full\" v-model=\"editObj.room_id\">\r\n              <vs-select-item value :text=\"$t('all')\" />\r\n              <vs-select-item\r\n                :key=\"index\"\r\n                :value=\"item.room_id\"\r\n                :text=\"$t(item.room_name)\"\r\n                v-for=\"(item,index) in rooms\"\r\n              />\r\n            </vs-select>\r\n          </div>\r\n        </div>\r\n        <div class=\"vx-row\">\r\n          <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-6\">\r\n            <label>{{$t(\"date\")}}</label>\r\n            <flat-pickr\r\n              :config=\"configdateTimePicker\"\r\n              class=\"w-full\"\r\n              v-model=\"editObj.date\"\r\n              placeholder=\"Choose time\"\r\n            />\r\n          </div>\r\n\r\n          <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-6\">\r\n            <div style=\"width:45%;float:left\">\r\n              <label>{{$t(\"time\")}}</label>\r\n              <flat-pickr\r\n                :config=\"configTime\"\r\n                class=\"w-full\"\r\n                v-model=\"editObj.start_time\"\r\n                placeholder=\"Choose time\"\r\n              />\r\n            </div>\r\n\r\n            <div style=\"width:10%;float:left;text-align:center;padding-top:30px\">{{$t('to')}}</div>\r\n            <div style=\"width:45%;padding-top:20px;float:left\">\r\n              <flat-pickr\r\n                :config=\"configTime\"\r\n                class=\"w-full\"\r\n                v-model=\"editObj.end_time\"\r\n                placeholder=\"Choose time\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div class=\"vx-col md:w-1/6 sm:w-1/2 w-full mt-6\" style=\"padding-top:20px;\">\r\n            <vs-button\r\n              ref=\"loadableButton\"\r\n              id=\"button-with-loading\"\r\n              class=\"vs-con-loading__container right\"\r\n              vslor=\"primary\"\r\n              @click=\"search()\"\r\n            >{{$t('search')}}</vs-button>\r\n          </div>\r\n        </div>\r\n      </vx-card>\r\n      <div class=\"mt-6 text-center\" v-if=\"room_lists.length==0&&searched\">{{$t(\"no_data\")}}</div>\r\n      <div class=\"vx-row\">\r\n        <div\r\n          v-for=\"(item,index) in room_lists\"\r\n          :key=\"index\"\r\n          class=\"vx-col lg:w-1/3 md:w-1/2 w-full mt-5\"\r\n          style=\"padding:10px\"\r\n        >\r\n          <vx-card class=\"w-full\">\r\n            <table style=\"width:100%\">\r\n              <tr>\r\n                <td>{{$t(\"room_id\")}}</td>\r\n                <td>{{item.room_id}}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>{{$t(\"room_name\")}}</td>\r\n                <td>{{item.room_name}}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>{{$t(\"num_table\")}}</td>\r\n                <td>{{item.num_table}}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>{{$t(\"num_chair\")}}</td>\r\n                <td>{{item.num_chair}}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>{{$t(\"status\")}}</td>\r\n                <td\r\n                  :style=\"{color:item.status=='1'?'green':'red'}\"\r\n                >{{item.status=='1'?$t('Available'):$t('Not Available')}}</td>\r\n              </tr>\r\n              <tr>\r\n                <td colspan=\"2\">\r\n                  <vs-button\r\n                    ref=\"loadableButton\"\r\n                    id=\"button-with-loading1\"\r\n                    class=\"vs-con-loading__container\"\r\n                    vslor=\"primary\"\r\n                    @click=\"book(item)\"\r\n                    :disabled=\"item.status=='0'\"\r\n                  >{{$t('book_this_room')}}</vs-button>\r\n                </td>\r\n              </tr>\r\n            </table>\r\n          </vx-card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"w-full\" v-if=\"booking\">\r\n      <vx-card>\r\n        <div class=\"vx-row\">\r\n          <div class=\"vx-col full\">\r\n            <h6>{{$t('booking_room')}}</h6>\r\n          </div>\r\n        </div>\r\n        <div class=\"mt-6 vx-row lg:ml-10 lg:mr-10\">\r\n          <div class=\"vx-col lg:w-1/2 w-full\">\r\n            <table style=\"width:100%\">\r\n              <tr>\r\n                <td style=\"padding:5px\">{{$t(\"username\")}}</td>\r\n                <td class=\"text-primary\">{{booking_data.first_name+' '+booking_data.last_name}}</td>\r\n              </tr>\r\n              <tr></tr>\r\n              <tr style>\r\n                <td style=\"padding:5px\">{{$t('start_date')}}</td>\r\n                <td class=\"text-primary\">{{booking_data.start_date}}</td>\r\n              </tr>\r\n              <tr style>\r\n                <td style=\"padding:5px\">{{$t('email')}}</td>\r\n                <td class=\"text-primary\">{{booking_data.email}}</td>\r\n              </tr>\r\n            </table>\r\n          </div>\r\n          <div class=\"vx-col lg:w-1/2 w-full\">\r\n            <table style=\"width:100%\">\r\n              <tr>\r\n                <td>{{$t(\"room_name\")}}</td>\r\n                <td class=\"text-primary\">{{booking_data.room_name}}</td>\r\n              </tr>\r\n              <tr></tr>\r\n              <tr>\r\n                <td>{{$t('end_date')}}</td>\r\n                <td class=\"text-primary\">{{booking_data.end_date}}</td>\r\n              </tr>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <vs-divider position=\"left\">{{$t(\"detail_input\")}}</vs-divider>\r\n        <div class=\"container\">\r\n          <div class=\"vx-row mt-10\">\r\n            <div class=\"vx-col md:w-1/4 sm:w-1/3 w-full\">\r\n              {{$t(\"detail\")}}\r\n              <span class=\"require\">*</span>:\r\n            </div>\r\n            <div class=\"vx-col md:w-3/4 sm:w-2/3 w-full\">\r\n              <vs-input class=\"w-full\" v-model=\"detail\" :danger=\"submitted&&detail==''\" />\r\n              <div class=\"errors\" v-if=\"submitted&&detail==''\">{{$t(\"Please input subject\")}}</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"vx-row mt-5 mb-10\">\r\n            <div class=\"vx-col md:w-1/4 sm:w-1/3 w-full\">\r\n              {{$t(\"importance\")}} :\r\n              <span class=\"require\">*</span>\r\n            </div>\r\n            <div class=\"vx-col md:w-3/4 sm:w-2/3 w-full\">\r\n              <vs-select class=\"w-full\" v-model=\"important\" :danger=\"important==''&&submitted\">\r\n                <vs-select-item\r\n                  :key=\"index\"\r\n                  :value=\"item\"\r\n                  :text=\"$t(item)\"\r\n                  v-for=\"(item,index) in important_lists\"\r\n                />\r\n              </vs-select>\r\n\r\n              <div class=\"errors\" v-if=\"submitted&&important==''\">{{$t(\"Please select important\")}}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"vx-row mt-5 mb-10\">\r\n            <div class=\"vx-col md:w-1/4 sm:w-1/3 w-full\">\r\n              {{$t(\"Number of Member\")}} :\r\n              <span class=\"require\">*</span>\r\n            </div>\r\n            <div class=\"vx-col md:w-3/4 sm:w-2/3 w-full\">\r\n              <vs-input\r\n                class=\"w-full\"\r\n                v-model=\"member\"\r\n                :danger=\"submitted&&member==''\"\r\n                @keypress=\"checkNumber\"\r\n              />\r\n              <div\r\n                class=\"errors\"\r\n                v-if=\"submitted&&member==''\"\r\n              >{{$t(\"Please input number of member\")}}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"vx-row mt-5 mb-10\">\r\n            <div class=\"vx-col md:w-1/4 sm:w-1/3 w-full\">\r\n              {{$t(\"Remark\")}} :\r\n              <span class=\"require\">*</span>\r\n            </div>\r\n            <div class=\"vx-col md:w-3/4 sm:w-2/3 w-full\">\r\n              <vs-input class=\"w-full\" v-model=\"remark\" :danger=\"submitted&&remark==''\" />\r\n              <div class=\"errors\" v-if=\"submitted&&remark==''\">{{$t(\"Please input remark\")}}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"vx-row mt-5 mb-10\">\r\n            <div class=\"vx-col md:w-1/4 sm:w-1/3 w-full\">\r\n              {{$t(\"Tel\")}} :\r\n              <span class=\"require\">*</span>\r\n            </div>\r\n            <div class=\"vx-col md:w-3/4 sm:w-2/3 w-full\">\r\n              <vs-input\r\n                class=\"w-full\"\r\n                v-model=\"tel\"\r\n                :danger=\"submitted&&tel==''\"\r\n                maxlength=\"10\"\r\n                @keypress=\"checkNumber\"\r\n              />\r\n              <div class=\"errors\" v-if=\"submitted&&tel==''\">{{$t(\"Please input remark\")}}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <vs-divider position=\"left\">{{$t(\"material_using\")}}</vs-divider>\r\n        <div class=\"container\">\r\n          <div class=\"vx-row\">\r\n            <div class=\"vx-col w-full mt-5\">\r\n              <vs-button\r\n                color=\"primary\"\r\n                icon-pack=\"feather\"\r\n                icon=\"icon-plus\"\r\n                @click=\"add()\"\r\n              >{{$t('add')}}</vs-button>\r\n            </div>\r\n          </div>\r\n          <div class=\"vx-row\" v-for=\"(item,index) in material_lists\" :key=\"index\">\r\n            <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-5\">\r\n              {{$t(\"material\")}} ({{$t('material_price')}})\r\n              <vs-select\r\n                class=\"w-full\"\r\n                v-model=\"item.material_id\"\r\n                :danger=\"item.material_id==''&&submitted\"\r\n              >\r\n                <vs-select-item\r\n                  :key=\"index\"\r\n                  :value=\"material.material_id\"\r\n                  :text=\"$t(material.material_name+' ('+material.material_price+')')\"\r\n                  v-for=\"(material,index) in materials\"\r\n                />\r\n              </vs-select>\r\n              <div\r\n                class=\"errors\"\r\n                v-if=\"item.material_id==''&&submitted\"\r\n              >{{$t('please select material')}}</div>\r\n            </div>\r\n            <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-5\">\r\n              {{$t(\"material_number\")}}\r\n              <vs-input\r\n                class=\"w-full\"\r\n                v-model=\"item.material_number\"\r\n                @keypress=\"checkNumber\"\r\n                :danger=\"item.material_number==''&&submitted\"\r\n              />\r\n              <div\r\n                class=\"errors\"\r\n                v-if=\"item.material_number==''&&submitted\"\r\n              >{{$t('please input the number of material')}}</div>\r\n            </div>\r\n            <div class=\"vx-col md:w-1/3 sm:w-1/2 w-full mt-10\">\r\n              <vs-button\r\n                ref=\"loadableButton\"\r\n                color=\"danger\"\r\n                @click=\"material_lists.splice(index,1)\"\r\n              >{{$t('remove')}}</vs-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"container\">\r\n          <div class=\"vx-row mt-10\">\r\n            <div class=\"w-full\">\r\n              <vs-button class=\"mr-4\" @click=\"save()\">{{$t('save')}}</vs-button>\r\n              <vs-button\r\n                color=\"danger\"\r\n                type=\"border\"\r\n                @click=\"booking=false;booking_data={}\"\r\n              >{{$t('cancel')}}</vs-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </vx-card>\r\n    </div>\r\n  </div>\r\n  <!-- <button>click</button> -->\r\n</template>\r\n<style lang=\"scss\" scoped>\r\n.right {\r\n  float: right;\r\n  margin-right: 10px;\r\n}\r\n.require {\r\n  color: red;\r\n}\r\n\r\n.danger input {\r\n  padding: 0.7rem;\r\n  font-size: 1rem;\r\n  border-radius: 5px;\r\n  border: 1px solid red;\r\n  color: #626262;\r\n  width: 100%;\r\n}\r\n.error {\r\n  color: red;\r\n  font-size: 80%;\r\n}\r\ntd {\r\n  width: 50%;\r\n  padding: 10px;\r\n}\r\n</style>\r\n\r\n\r\n<script>\r\nimport Datepicker from \"vuejs-datepicker\";\r\nimport service from \"@/service/service\";\r\n// import ViewData from './view/ViewData.vue';\r\nimport moment from \"moment\";\r\n// import firebase from 'firebase/app'ว\r\n// import * as firebase from 'firebase/app';\r\nimport flatPickr from \"vue-flatpickr-component\";\r\nimport \"flatpickr/dist/flatpickr.css\";\r\nimport { async } from \"q\";\r\n// import '@firebase/messaging';\r\nexport default {\r\n  components: {\r\n    Datepicker,\r\n    flatPickr\r\n  },\r\n  data() {\r\n    return {\r\n      submitted: false,\r\n      renderComponent: true,\r\n      editObj: {},\r\n      booking: false,\r\n      detail: \"\",\r\n      buildings: [],\r\n      important: \"\",\r\n      remark: \"\",\r\n      tel: \"\",\r\n      member: \"\",\r\n      searched: false,\r\n      rooms: [],\r\n      materials: [],\r\n      booking_data: {},\r\n      material: {},\r\n      material_lists: [],\r\n      configdateTimePicker: {\r\n        enableTime: false,\r\n        enableSeconds: false,\r\n        noCalendar: false\r\n      },\r\n      configTime: {\r\n        enableTime: true,\r\n        enableSeconds: true,\r\n        noCalendar: true\r\n      },\r\n      room_lists: [],\r\n      important_lists: [\"normal\", \"important\"]\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    body() {\r\n      return {\r\n        room_id: this.editObj.room_id,\r\n        start_date: this.editObj.date + \" \" + this.editObj.start_time,\r\n        end_date: this.editObj.date + \" \" + this.editObj.end_time,\r\n        building_id: this.editObj.building_id\r\n      };\r\n    }\r\n  },\r\n  async created() {\r\n    this.material = { material_id: \"\", material_number: \"\" };\r\n    this.initVal();\r\n\r\n    try {\r\n      var result = await service.postData(\"material/get\", {});\r\n\r\n      this.materials = result.data;\r\n\r\n      result = await service.postData(\"building/getBuilding\", {});\r\n      this.buildings = result.data;\r\n    } catch (e) {\r\n      this.$swal(this.$t(\"error\"), e.message, \"error\");\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    checkNumber(e) {\r\n      var checkNumber = window.checkNumber(e);\r\n      if (!checkNumber) {\r\n        e.preventDefault();\r\n      }\r\n    },\r\n    async initVal() {\r\n      this.editObj = {\r\n        building_id: \"\",\r\n        room_id: \"\",\r\n        date: moment().format(\"YYYY-MM-DD\"),\r\n        start_time: moment().format(\"HH:mm:ss\"),\r\n        end_time: \"17:30:00\"\r\n      };\r\n      this.booking = false;\r\n      this.detail = \"\";\r\n      this.buildings = [];\r\n      this.important = \"\";\r\n      this.remark = \"\";\r\n      this.tel = \"\";\r\n      this.member = \"\";\r\n    },\r\n    search() {\r\n      this.searched = true;\r\n      console.log(\"searching\");\r\n\r\n      if (!moment(this.body.start_date).isBefore(moment(this.body.end_date))) {\r\n        this.$swal(this.$t(\"start_date_canot_more_than_end_date\"), \"\", \"error\");\r\n      } else {\r\n        this.$vs.loading({\r\n          background: this.backgroundLoading,\r\n          color: this.colorLoading,\r\n          container: \"#button-with-loading\",\r\n          scale: 0.45\r\n        });\r\n        service.postData(\"get_room_with_status\", this.body).then(\r\n          result => {\r\n            this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\");\r\n            this.room_lists = result.data;\r\n          },\r\n          err => {\r\n            this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\");\r\n          }\r\n        );\r\n      }\r\n    },\r\n    add() {\r\n      this.material_lists.push({ material_id: \"\", material_number: \"\" });\r\n    },\r\n    book(item) {\r\n      this.booking = true;\r\n      var { username, first_name, last_name, email } = service.getUser().user;\r\n      this.booking_data = {\r\n        room_id: item.room_id,\r\n        start_date: this.body.start_date,\r\n        end_date: this.body.end_date,\r\n        username: username,\r\n        first_name: first_name,\r\n        last_name: last_name,\r\n        room_name: item.room_name,\r\n        email: email\r\n      };\r\n    },\r\n    checkMaterial() {\r\n      var x = this.material_lists.filter(item => {\r\n        return item.material_id == \"\" || item.material_number == \"\";\r\n      });\r\n      console.log(x);\r\n      return x.length == 0;\r\n    },\r\n    save() {\r\n      this.submitted = true;\r\n      var result = [];\r\n\r\n      if (\r\n        this.detail != \"\" &&\r\n        this.important != \"\" &&\r\n        this.member != \"\" &&\r\n        this.remark != \"\" &&\r\n        this.tel != \"\" &&\r\n        this.checkMaterial()\r\n      ) {\r\n        var materials = this.material_lists.map(item => item);\r\n        materials\r\n          .filter(item => item.material_number != \"\")\r\n          .reduce(function(res, value) {\r\n            if (!res[value.material_id]) {\r\n              res[value.material_id] = {\r\n                Id: value.material_id,\r\n                material_number: 0\r\n              };\r\n              result.push(res[value.material_id]);\r\n            }\r\n            res[value.material_id].material_number =\r\n              parseInt(res[value.material_id].material_number) +\r\n              parseInt(value.material_number);\r\n            return res;\r\n          }, {});\r\n        var material_lists = result.filter(item => item.material_number > 0);\r\n        this.$swal({\r\n          title: this.$t(\"booking_room_title\"),\r\n          type: \"warning\",\r\n          showCancelButton: true,\r\n          confirmButtonColor: \"#3085d6\",\r\n          cancelButtonColor: \"#d33\",\r\n          cancelButtonText: this.$t(\"cancel\"),\r\n          confirmButtonText: this.$t(\"book\"),\r\n          showLoaderOnConfirm: true,\r\n          preConfirm: () => {\r\n            var { username, room_id, start_date, end_date } = this.booking_data;\r\n            return service\r\n              .postData(\"/booking_room\", {\r\n                booking_description: this.detail,\r\n                username,\r\n                room_id,\r\n                start_date,\r\n                end_date,\r\n                material_lists,\r\n                important: this.important,\r\n                member: this.member,\r\n                remark: this.remark,\r\n                tel: this.tel\r\n              })\r\n              .then(result => {\r\n                return result;\r\n              });\r\n          }\r\n        }).then(result => {\r\n          if (result.value) {\r\n            if (result.value.code) {\r\n              this.$swal(this.$t(\"success_title\"), \"\", \"success\").then(\r\n                result => {\r\n                  this.booking = false;\r\n                  service.postData(\"get_room_with_status\", this.body).then(\r\n                    result => {\r\n                      // this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\")\r\n                      this.room_lists = result.data;\r\n                      this.material_lists = [];\r\n                      this.detail = \"\";\r\n                      this.important = \"\";\r\n                      this.submitted = false;\r\n                      this.initVal();\r\n                    },\r\n                    err => {\r\n                      // this.$vs.loading.close(\"#button-with-loading > .con-vs-loading\")\r\n                    }\r\n                  );\r\n                }\r\n              );\r\n            } else {\r\n              this.$swal(this.$t(\"error\"), result.value.message, \"error\");\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    async \"editObj.building_id\"(val) {\r\n      this.editObj.room_id = \"\";\r\n      var result = await service.postData(\"getRoomByBuilding\", {\r\n        building_id: this.editObj.building_id\r\n      });\r\n      this.rooms = result.data;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n"]}]}